# Suit-MBTI çµ±åˆã‚·ã‚¹ãƒ†ãƒ é–‹ç™ºãƒã‚¹ã‚¿ãƒ¼ãƒ—ãƒ©ãƒ³

**ä½œæˆæ—¥**: 2025-01  
**ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 1.0  
**ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: é–‹ç™ºè¨ˆç”»ç­–å®šå®Œäº†

---

## ğŸ“‹ ã‚¨ã‚°ã‚¼ã‚¯ãƒ†ã‚£ãƒ–ã‚µãƒãƒªãƒ¼

ç¾åœ¨ã®ã€ŒSuit-MBTIï¼ˆãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰è¨ºæ–­ãƒ„ãƒ¼ãƒ«ï¼‰ã€ã‚’æ ¸ã¨ã—ã€**TailorCloudã®æ—¢å­˜ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰**ã¨çµ±åˆã—ã€ãƒãƒƒã‚¯ã‚ªãƒ•ã‚£ã‚¹æ¥­å‹™ï¼ˆäºˆç´„ãƒ»ç™ºæ³¨ãƒ»é¡§å®¢ç®¡ç†ï¼‰ã€æ±ºæ¸ˆã€3DæŠ€è¡“ã‚’çµ±åˆã—ãŸã€Œã‚ªãƒ¼ãƒ€ãƒ¼ã‚¹ãƒ¼ãƒ„D2Cãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã€ã‚’æ§‹ç¯‰ã—ã¾ã™ã€‚

**çµ±åˆæˆ¦ç•¥**: 
- **æ—¢å­˜TailorCloudãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ï¼ˆGoï¼‰ã‚’æ´»ç”¨** â†’ é–‹ç™ºå·¥æ•°å‰Šæ¸›ã€å …ç‰¢æ€§ç¢ºä¿
- **Suit-MBTIï¼ˆReactï¼‰ã‚’ç®¡ç†ç”»é¢ã¨ã—ã¦æ‹¡å¼µ**
- **æ–°ã—ã„ãƒ¢ãƒãƒªãƒæ§‹æˆ** â†’ ã‚³ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹ã®ä¸€å…ƒç®¡ç†

---

## ğŸ—ï¸ ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“åƒ (Architecture)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              TailorCloud Ã— Suit-MBTI çµ±åˆãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚  Suit-MBTI      â”‚              â”‚  TailorCloud     â”‚      â”‚
â”‚  â”‚  (React/TS)     â”‚              â”‚  Mobile App      â”‚      â”‚
â”‚  â”‚  - è¨ºæ–­ãƒ„ãƒ¼ãƒ«   â”‚              â”‚  (Flutter)       â”‚      â”‚
â”‚  â”‚  - ç®¡ç†ç”»é¢     â”‚              â”‚  - ç™ºæ³¨ç®¡ç†      â”‚      â”‚
â”‚  â”‚  - CRM          â”‚              â”‚  - åœ¨åº«ç®¡ç†      â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚           â”‚                                 â”‚                â”‚
â”‚           â”‚ HTTPS/REST API                  â”‚                â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                        â”‚                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚      TailorCloud Backend API (Go)         â”‚              â”‚
â”‚  â”‚      - æ—¢å­˜APIæ‹¡å¼µ                        â”‚              â”‚
â”‚  â”‚      - è¨ºæ–­ãƒ‡ãƒ¼ã‚¿çµ±åˆ                     â”‚              â”‚
â”‚  â”‚      - äºˆç´„ç®¡ç†                           â”‚              â”‚
â”‚  â”‚      - æ±ºæ¸ˆå‡¦ç†ï¼ˆStripeï¼‰                 â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                â”‚                 â”‚                          â”‚
â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚      â”‚   PostgreSQL      â”‚  â”‚  Firestore   â”‚              â”‚
â”‚      â”‚   (Primary DB)    â”‚  â”‚ (Secondary)  â”‚              â”‚
â”‚      â”‚                   â”‚  â”‚              â”‚              â”‚
â”‚      â”‚ - Orders          â”‚  â”‚ - Diagnoses  â”‚              â”‚
â”‚      â”‚ - Customers       â”‚  â”‚ - Appointmentsâ”‚             â”‚
â”‚      â”‚ - Fabrics         â”‚  â”‚ - Chat Logs  â”‚              â”‚
â”‚      â”‚ - Audit Logs      â”‚  â”‚ - UI Status  â”‚              â”‚
â”‚      â”‚ - Diagnoses (NEW) â”‚  â”‚              â”‚              â”‚
â”‚      â”‚ - Appointments (NEW)â”‚              â”‚              â”‚
â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                â”‚                                           â”‚
â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                               â”‚
â”‚      â”‚  Cloud Storage    â”‚                               â”‚
â”‚      â”‚  (PDF Documents)  â”‚                               â”‚
â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                               â”‚
â”‚                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚  â”‚  External Services                  â”‚                â”‚
â”‚  â”‚  - Stripe (Payment)                 â”‚                â”‚
â”‚  â”‚  - Bodygram (3Dæ¡å¯¸)                â”‚                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ é–‹ç™ºãƒ•ã‚§ãƒ¼ã‚ºè©³ç´°

### Phase 1: ç®¡ç†ç”»é¢ & CRMæ§‹ç¯‰

**æœŸé–“**: 3ã€œ4é€±é–“  
**ç›®çš„**: é¡§å®¢ãƒ‡ãƒ¼ã‚¿ã®ä¸€å…ƒç®¡ç†ã¨ã€ã‚ªãƒšãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®åŠ¹ç‡åŒ–

#### 1.1 ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆæ‹¡å¼µ

æ—¢å­˜ã®TailorCloudã‚¹ã‚­ãƒ¼ãƒã«ä»¥ä¸‹ã‚’è¿½åŠ ï¼š

##### Diagnoses (è¨ºæ–­ãƒ­ã‚°) - NEW

| ã‚«ãƒ©ãƒ å | å‹ | èª¬æ˜ |
|---------|-----|------|
| id | VARCHAR(50) PK | è¨ºæ–­ID |
| user_id | VARCHAR(50) FK | ãƒ¦ãƒ¼ã‚¶ãƒ¼IDï¼ˆé¡§å®¢ï¼‰ |
| tenant_id | VARCHAR(50) FK | ãƒ†ãƒŠãƒ³ãƒˆID |
| archetype | VARCHAR(50) | é¸æŠã‚¢ãƒ¼ã‚­ã‚¿ã‚¤ãƒ—ï¼ˆRATã‚¿ã‚¤ãƒ—ï¼‰ |
| plan_type | VARCHAR(50) | ãƒ—ãƒ©ãƒ³ï¼ˆBest Value / Authenticï¼‰ |
| diagnosis_result | JSONB | è¨ºæ–­çµæœè©³ç´°ï¼ˆJSONå½¢å¼ï¼‰ |
| created_at | TIMESTAMPTZ | ä½œæˆæ—¥æ™‚ |
| updated_at | TIMESTAMPTZ | æ›´æ–°æ—¥æ™‚ |

**ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹**:
- `idx_diagnoses_user_id` (user_id)
- `idx_diagnoses_tenant_id` (tenant_id)
- `idx_diagnoses_archetype` (archetype)

##### Appointments (äºˆç´„) - NEW

| ã‚«ãƒ©ãƒ å | å‹ | èª¬æ˜ |
|---------|-----|------|
| id | VARCHAR(50) PK | äºˆç´„ID |
| user_id | VARCHAR(50) FK | ãƒ¦ãƒ¼ã‚¶ãƒ¼IDï¼ˆé¡§å®¢ï¼‰ |
| tenant_id | VARCHAR(50) FK | ãƒ†ãƒŠãƒ³ãƒˆID |
| fitter_id | VARCHAR(50) FK | ãƒ•ã‚£ãƒƒã‚¿ãƒ¼IDï¼ˆã‚¹ã‚¿ãƒƒãƒ•ï¼‰ |
| appointment_datetime | TIMESTAMPTZ | äºˆç´„æ—¥æ™‚ |
| status | VARCHAR(20) | ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ï¼ˆConfirmed/Cancelled/Completedï¼‰ |
| deposit_amount | BIGINT | ãƒ‡ãƒã‚¸ãƒƒãƒˆé‡‘é¡ |
| deposit_payment_intent_id | VARCHAR(255) | Stripe Payment Intent ID |
| notes | TEXT | ãƒ¡ãƒ¢ |
| created_at | TIMESTAMPTZ | ä½œæˆæ—¥æ™‚ |
| updated_at | TIMESTAMPTZ | æ›´æ–°æ—¥æ™‚ |

**ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹**:
- `idx_appointments_user_id` (user_id)
- `idx_appointments_tenant_id` (tenant_id)
- `idx_appointments_fitter_id` (fitter_id)
- `idx_appointments_datetime` (appointment_datetime)
- `idx_appointments_status` (status)

##### Customers ãƒ†ãƒ¼ãƒ–ãƒ«æ‹¡å¼µ

æ—¢å­˜ã®`customers`ãƒ†ãƒ¼ãƒ–ãƒ«ã«ä»¥ä¸‹ã‚’è¿½åŠ ï¼š

| ã‚«ãƒ©ãƒ å | å‹ | èª¬æ˜ |
|---------|-----|------|
| occupation | VARCHAR(255) | è·æ¥­ |
| annual_income_range | VARCHAR(50) | å¹´åæ„Ÿï¼ˆä¾‹: "500-1000ä¸‡å††"ï¼‰ |
| ltv_score | DECIMAL(10,2) | LTVã‚¹ã‚³ã‚¢ï¼ˆè¨ˆç®—ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ï¼‰ |
| preferred_archetype | VARCHAR(50) | å¥½ã¿ã®ã‚¢ãƒ¼ã‚­ã‚¿ã‚¤ãƒ— |
| diagnosis_count | INTEGER | è¨ºæ–­å›æ•° |

#### 1.2 ç®¡ç†ç”»é¢æ©Ÿèƒ½ï¼ˆSuit-MBTI Reactæ‹¡å¼µï¼‰

**æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯**:
- React 18+
- TypeScript
- Tailwind CSS
- React Router
- TanStack Query (React Query)
- Zustand (çŠ¶æ…‹ç®¡ç†)

**ç”»é¢æ§‹æˆ**:

##### 1.2.1 äºˆç´„ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼

**æ©Ÿèƒ½**:
- Googleã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ãƒ©ã‚¤ã‚¯ãªUI
- ãƒ•ã‚£ãƒƒã‚¿ãƒ¼ã®ç©ºãæ ã¨äºˆç´„çŠ¶æ³ã‚’å¯è¦–åŒ–
- ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—ã§äºˆç´„æ™‚é–“å¤‰æ›´
- äºˆç´„ã‚¯ãƒªãƒƒã‚¯ã§è©³ç´°è¡¨ç¤ºãƒ»ç·¨é›†

**APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**:
- `GET /api/appointments?tenant_id={id}&start_date={date}&end_date={date}` - äºˆç´„ä¸€è¦§å–å¾—
- `POST /api/appointments` - äºˆç´„ä½œæˆ
- `PUT /api/appointments/{id}` - äºˆç´„æ›´æ–°
- `DELETE /api/appointments/{id}` - äºˆç´„ã‚­ãƒ£ãƒ³ã‚»ãƒ«

##### 1.2.2 ãƒ‡ã‚¸ã‚¿ãƒ«ã‚«ãƒ«ãƒ†

**æ©Ÿèƒ½**:
- é¡§å®¢ã®è¨ºæ–­çµæœï¼ˆRATã‚¿ã‚¤ãƒ—ï¼‰è¡¨ç¤º
- èº«ä½“ã®ã‚¯ã‚»ï¼ˆè£œæ­£ç®‡æ‰€ï¼‰è¡¨ç¤º
- éå»ã®è³¼å…¥å±¥æ­´è¡¨ç¤º
- æ¥å®¢æ™‚ã®ãƒ¡ãƒ¢æ©Ÿèƒ½

**APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**:
- `GET /api/customers/{id}/profile` - é¡§å®¢ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ï¼ˆè¨ºæ–­çµæœå«ã‚€ï¼‰
- `GET /api/customers/{id}/diagnoses` - è¨ºæ–­å±¥æ­´
- `GET /api/customers/{id}/orders` - æ³¨æ–‡å±¥æ­´ï¼ˆæ—¢å­˜ï¼‰
- `POST /api/customers/{id}/notes` - ãƒ¡ãƒ¢è¿½åŠ 

##### 1.2.3 KPIãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰

**æ©Ÿèƒ½**:
- æœˆæ¬¡å£²ä¸Šè¡¨ç¤º
- äºˆç´„æ•°è¡¨ç¤º
- ãƒ—ãƒ©ãƒ³åˆ¥æ§‹æˆæ¯”ï¼ˆBest Value vs Authenticï¼‰
- CPAï¼ˆé¡§å®¢ç²å¾—å˜ä¾¡ï¼‰è¨ˆæ¸¬ç”¨ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿åˆ†æ

**APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**:
- `GET /api/analytics/sales?tenant_id={id}&period={month}` - å£²ä¸Šåˆ†æ
- `GET /api/analytics/appointments?tenant_id={id}&period={month}` - äºˆç´„åˆ†æ
- `GET /api/analytics/plan-distribution?tenant_id={id}` - ãƒ—ãƒ©ãƒ³åˆ¥æ§‹æˆæ¯”
- `GET /api/analytics/cpa?tenant_id={id}&period={month}` - CPAåˆ†æ

---

### Phase 2: æ±ºæ¸ˆãƒ»æ³•å‹™å¯¾å¿œæ©Ÿèƒ½

**æœŸé–“**: 2ã€œ3é€±é–“  
**ç›®çš„**: åç›Šã®ç¢ºå®šã¨ã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹éµå®ˆ

#### 2.1 Stripeå°å…¥

**æ—¢å­˜TailorCloudã®æ±ºæ¸ˆæ©Ÿèƒ½ã«çµ±åˆ**

##### äº‹å‰æ±ºæ¸ˆï¼ˆæ‰‹ä»˜é‡‘ï¼‰

**æ©Ÿèƒ½**:
- äºˆç´„æ™‚ã« Â¥5,000ã€œÂ¥10,000 ã®ãƒ‡ãƒã‚¸ãƒƒãƒˆæ±ºæ¸ˆ
- Stripe Payment Intent APIã‚’ä½¿ç”¨
- äºˆç´„ç¢ºå®šæ™‚ã«è‡ªå‹•æ±ºæ¸ˆ

**APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**:
- `POST /api/appointments/{id}/create-payment-intent` - Payment Intentä½œæˆ
- `POST /api/appointments/{id}/confirm-payment` - æ±ºæ¸ˆç¢ºå®š
- `POST /api/appointments/{id}/cancel-payment` - æ±ºæ¸ˆã‚­ãƒ£ãƒ³ã‚»ãƒ«ï¼ˆè¿”é‡‘ï¼‰

##### ã‚­ãƒ£ãƒ³ã‚»ãƒ«ãƒãƒªã‚·ãƒ¼

**ãƒ­ã‚¸ãƒƒã‚¯**:
- 3æ—¥å‰ã¾ã§: å…¨é¡è¿”é‡‘
- 2æ—¥å‰ã€œå½“æ—¥: ãƒ‡ãƒã‚¸ãƒƒãƒˆã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«æ–™ã¨ã—ã¦å……å½“

**APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**:
- `POST /api/appointments/{id}/cancel` - äºˆç´„ã‚­ãƒ£ãƒ³ã‚»ãƒ«ï¼ˆè‡ªå‹•çš„ã«è¿”é‡‘ãƒãƒªã‚·ãƒ¼é©ç”¨ï¼‰

##### å…¨é¡æ±ºæ¸ˆ

**æ©Ÿèƒ½**:
- ã‚ªãƒ³ãƒ©ã‚¤ãƒ³å®Œçµå‹ã®å…¨é¡æ±ºæ¸ˆãƒ•ãƒ­ãƒ¼
- æ³¨æ–‡ç¢ºå®šæ™‚ã«å…¨é¡æ±ºæ¸ˆ

**APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**:
- `POST /api/orders/{id}/create-payment-intent` - Payment Intentä½œæˆ
- `POST /api/orders/{id}/confirm-payment` - æ±ºæ¸ˆç¢ºå®š

#### 2.2 å¸³ç¥¨ç™ºè¡Œã‚·ã‚¹ãƒ†ãƒ 

**æ—¢å­˜TailorCloudã®ã‚¤ãƒ³ãƒœã‚¤ã‚¹æ©Ÿèƒ½ã‚’æ‹¡å¼µ**

##### ã‚¤ãƒ³ãƒœã‚¤ã‚¹å¯¾å¿œé ˜åæ›¸

**æ©Ÿèƒ½**:
- æ±ºæ¸ˆå®Œäº†ãƒ¡ãƒ¼ãƒ«ã«é ˜åæ›¸PDFã‚’æ·»ä»˜
- ãƒã‚¤ãƒšãƒ¼ã‚¸ã‹ã‚‰é ˜åæ›¸ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰å¯èƒ½
- é©æ ¼è«‹æ±‚æ›¸ç™ºè¡Œäº‹æ¥­è€…ç™»éŒ²ç•ªå·ï¼ˆTç•ªå·ï¼‰å…¥ã‚Š

**APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**:
- `POST /api/orders/{id}/generate-receipt` - é ˜åæ›¸ç”Ÿæˆï¼ˆæ—¢å­˜ã®`generate-invoice`ã‚’æ‹¡å¼µï¼‰
- `GET /api/orders/{id}/receipt` - é ˜åæ›¸å–å¾—

---

### Phase 3: 3Dæ¡å¯¸APIé€£æº

**æœŸé–“**: 4ã€œ6é€±é–“  
**ç›®çš„**: ã€Œã‚¹ãƒãƒ›ã§æ¡å¯¸ã€ã®ãƒ‡ãƒ¼ã‚¿ã‚’è£½é€ ãƒ‡ãƒ¼ã‚¿ã¸ç›´çµã•ã›ã‚‹

#### 3.1 APIä»•æ§˜ç­–å®š

##### 3Dæ¡å¯¸ãƒ‡ãƒ¼ã‚¿å—ä¿¡ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ

**Endpoint**: `POST /api/v1/measurements/import`

**Payload (JSON)**:
```json
{
  "userId": "usr_12345",
  "tenantId": "tenant_001",
  "provider": "Bodygram",
  "scanDate": "2025-11-30T10:00:00Z",
  "data": {
    "neck": 38.5,
    "shoulder": 44.0,
    "sleeve": 82.0,
    "chest": 96.0,
    "waist": 82.0,
    "hip": 98.0,
    "inseam": 78.0,
    "outseam": 100.0
  }
}
```

**Response**:
```json
{
  "measurement_id": "measurement_001",
  "user_id": "usr_12345",
  "status": "imported",
  "created_at": "2025-11-30T10:00:00Z"
}
```

##### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ

**Measurements (3Dæ¡å¯¸ãƒ‡ãƒ¼ã‚¿) - NEW**

| ã‚«ãƒ©ãƒ å | å‹ | èª¬æ˜ |
|---------|-----|------|
| id | VARCHAR(50) PK | æ¡å¯¸ID |
| user_id | VARCHAR(50) FK | ãƒ¦ãƒ¼ã‚¶ãƒ¼ID |
| tenant_id | VARCHAR(50) FK | ãƒ†ãƒŠãƒ³ãƒˆID |
| provider | VARCHAR(50) | æä¾›å…ƒï¼ˆBodygramç­‰ï¼‰ |
| raw_data | JSONB | ç”Ÿãƒ‡ãƒ¼ã‚¿ï¼ˆãƒŒãƒ¼ãƒ‰å¯¸ï¼‰ |
| scan_date | TIMESTAMPTZ | ã‚¹ã‚­ãƒ£ãƒ³æ—¥æ™‚ |
| created_at | TIMESTAMPTZ | ä½œæˆæ—¥æ™‚ |

#### 3.2 ã€ŒãƒŒãƒ¼ãƒ‰å¯¸æ³•ã€â†’ã€Œä»•ä¸ŠãŒã‚Šå¯¸æ³•ã€å¤‰æ›ãƒ­ã‚¸ãƒƒã‚¯

**ç‰¹è¨±æ€§ã®é«˜ã„æŠ€è¡“è³‡ç”£**

##### ãƒãƒƒãƒ”ãƒ³ã‚°ã‚¨ãƒ³ã‚¸ãƒ³

**3è¦ç´ çµ±åˆãƒ­ã‚¸ãƒƒã‚¯**:
1. **è¨ºæ–­çµæœï¼ˆã‚¢ãƒ¼ã‚­ã‚¿ã‚¤ãƒ—ï¼‰**: ã‚†ã¨ã‚Šé‡ã®å¥½ã¿
2. **3Dæ¡å¯¸ãƒ‡ãƒ¼ã‚¿ï¼ˆãƒŒãƒ¼ãƒ‰å¯¸ï¼‰**: èº«ä½“ã®å®Ÿå¯¸
3. **é¸æŠç”Ÿåœ°ã®ç‰¹æ€§ï¼ˆä¼¸ç¸®æ€§ï¼‰**: ç”Ÿåœ°ã®ç‰©æ€§

**ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ **:

```go
// internal/service/measurement_converter.go

type MeasurementConverter struct {
    diagnosisRepo DiagnosisRepository
    fabricRepo    FabricRepository
}

func (c *MeasurementConverter) ConvertToFinalMeasurements(
    ctx context.Context,
    rawMeasurements *domain.Measurement,
    archetype string,
    fabricID string,
) (*domain.FinalMeasurements, error) {
    // 1. è¨ºæ–­çµæœã‹ã‚‰ã‚†ã¨ã‚Šé‡ã‚’å–å¾—
    archetypeConfig := c.getArchetypeConfig(archetype)
    
    // 2. ç”Ÿåœ°ã®ç‰¹æ€§ã‚’å–å¾—
    fabric, err := c.fabricRepo.GetByID(ctx, fabricID)
    if err != nil {
        return nil, err
    }
    
    // 3. å¤‰æ›ãƒ­ã‚¸ãƒƒã‚¯å®Ÿè¡Œ
    finalMeasurements := &domain.FinalMeasurements{
        Neck:    c.applyEase(rawMeasurements.Neck, archetypeConfig.NeckEase, fabric.StretchFactor),
        Shoulder: c.applyEase(rawMeasurements.Shoulder, archetypeConfig.ShoulderEase, fabric.StretchFactor),
        Chest:   c.applyEase(rawMeasurements.Chest, archetypeConfig.ChestEase, fabric.StretchFactor),
        // ... ä»–ã®å¯¸æ³•ã‚‚åŒæ§˜
    }
    
    return finalMeasurements, nil
}
```

**APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**:
- `POST /api/v1/measurements/{id}/convert` - å¤‰æ›å®Ÿè¡Œ
- `GET /api/v1/measurements/{id}/final` - å¤‰æ›æ¸ˆã¿å¯¸æ³•å–å¾—

---

## ğŸ› ï¸ æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

### ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ï¼ˆSuit-MBTIæ‹¡å¼µï¼‰

- **React**: 18+
- **TypeScript**: 5+
- **Tailwind CSS**: 3+
- **React Router**: 6+
- **TanStack Query**: 5+ (APIçŠ¶æ…‹ç®¡ç†)
- **Zustand**: 4+ (ã‚°ãƒ­ãƒ¼ãƒãƒ«çŠ¶æ…‹ç®¡ç†)
- **Vite**: 5+ (ãƒ“ãƒ«ãƒ‰ãƒ„ãƒ¼ãƒ«)

### ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ï¼ˆæ—¢å­˜TailorCloudæ‹¡å¼µï¼‰

- **è¨€èª**: Go 1.21+ï¼ˆæ—¢å­˜ï¼‰
- **ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯**: æ¨™æº–ãƒ©ã‚¤ãƒ–ãƒ©ãƒªï¼ˆnet/httpï¼‰ï¼ˆæ—¢å­˜ï¼‰
- **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹**: PostgreSQL + Firestoreï¼ˆæ—¢å­˜ï¼‰
- **èªè¨¼**: Firebase Authenticationï¼ˆæ—¢å­˜ï¼‰
- **æ±ºæ¸ˆ**: Stripeï¼ˆæ–°è¦è¿½åŠ ï¼‰
- **PDFç”Ÿæˆ**: gofpdf/v2ï¼ˆæ—¢å­˜ï¼‰

### ã‚¤ãƒ³ãƒ•ãƒ©

- **ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ **: Google Cloud Platformï¼ˆæ—¢å­˜ï¼‰
- **APIã‚µãƒ¼ãƒãƒ¼**: Cloud Runï¼ˆæ—¢å­˜ï¼‰
- **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹**: Cloud SQL (PostgreSQL)ï¼ˆæ—¢å­˜ï¼‰
- **ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸**: Cloud Storageï¼ˆæ—¢å­˜ï¼‰

---

## ğŸ“Š é–‹ç™ºå„ªå…ˆé †ä½

### æœ€å„ªå…ˆï¼ˆPhase 1ï¼‰

1. **è¨ºæ–­ãƒ‡ãƒ¼ã‚¿çµ±åˆ**
   - Diagnosesãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆ
   - è¨ºæ–­çµæœAPIå®Ÿè£…
   - Suit-MBTIã¨TailorCloudã®é€£æº

2. **äºˆç´„ç®¡ç†æ©Ÿèƒ½**
   - Appointmentsãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆ
   - äºˆç´„APIå®Ÿè£…
   - äºˆç´„ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼UIå®Ÿè£…

3. **ãƒ‡ã‚¸ã‚¿ãƒ«ã‚«ãƒ«ãƒ†**
   - é¡§å®¢ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«APIæ‹¡å¼µ
   - ã‚«ãƒ«ãƒ†UIå®Ÿè£…

### é«˜å„ªå…ˆåº¦ï¼ˆPhase 2ï¼‰

4. **æ±ºæ¸ˆæ©Ÿèƒ½ï¼ˆStripeï¼‰**
   - Stripeçµ±åˆ
   - ãƒ‡ãƒã‚¸ãƒƒãƒˆæ±ºæ¸ˆå®Ÿè£…
   - ã‚­ãƒ£ãƒ³ã‚»ãƒ«ãƒãƒªã‚·ãƒ¼å®Ÿè£…

5. **å¸³ç¥¨ç™ºè¡Œ**
   - é ˜åæ›¸ç”Ÿæˆæ©Ÿèƒ½æ‹¡å¼µ
   - ãƒ¡ãƒ¼ãƒ«é€ä¿¡çµ±åˆ

### ä¸­å„ªå…ˆåº¦ï¼ˆPhase 3ï¼‰

6. **3Dæ¡å¯¸APIé€£æº**
   - Measurementsãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆ
   - å¤–éƒ¨APIé€£æº
   - å¤‰æ›ãƒ­ã‚¸ãƒƒã‚¯å®Ÿè£…

---

## ğŸ”„ æ—¢å­˜TailorCloudã¨ã®çµ±åˆæ–¹é‡

### 1. ã‚³ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹çµ±åˆ

**ãƒ¢ãƒãƒªãƒæ§‹æˆ**:
```
tailor-cloud/
â”œâ”€â”€ backend/           # æ—¢å­˜ã®Goãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰
â”œâ”€â”€ mobile-app/        # æ—¢å­˜ã®Flutterã‚¢ãƒ—ãƒª
â”œâ”€â”€ web-app/           # æ–°è¦ï¼šSuit-MBTI Reactã‚¢ãƒ—ãƒª
â””â”€â”€ shared/            # å…±æœ‰å‹å®šç¾©ï¼ˆTypeScript/Goï¼‰
```

### 2. APIçµ±ä¸€

**æ—¢å­˜TailorCloud APIã‚’æ‹¡å¼µ**:
- æ—¢å­˜ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆæ§‹é€ ã‚’ç¶­æŒ
- æ–°ã—ã„ãƒªã‚½ãƒ¼ã‚¹ï¼ˆDiagnoses, Appointments, Measurementsï¼‰ã‚’è¿½åŠ 
- èªè¨¼ãƒ»èªå¯ã¯æ—¢å­˜ã®Firebase Auth + RBACã‚’ä½¿ç”¨

### 3. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹çµ±åˆ

**æ—¢å­˜ã‚¹ã‚­ãƒ¼ãƒã‚’æ‹¡å¼µ**:
- æ—¢å­˜ãƒ†ãƒ¼ãƒ–ãƒ«ã¯ãã®ã¾ã¾ä½¿ç”¨
- æ–°ã—ã„ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆDiagnoses, Appointments, Measurementsï¼‰ã‚’è¿½åŠ 
- æ—¢å­˜ã®ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ç®¡ç†æ–¹å¼ã‚’ç¶™ç¶š

---

## ğŸ“ æ¬¡ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³

### å³åº§ã«å®Ÿè¡Œ

1. **Suit-MBTIã‚³ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹ã®ç¢ºèª**
   - æ—¢å­˜ã®Reactã‚¢ãƒ—ãƒªã®æ§‹é€ ã‚’ç¢ºèª
   - TailorCloudãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã¸ã®çµ±åˆãƒã‚¤ãƒ³ãƒˆã‚’ç‰¹å®š

2. **é–‹ç™ºç’°å¢ƒã®æº–å‚™**
   - Suit-MBTIã®é–‹ç™ºç’°å¢ƒã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
   - TailorCloudãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã¨ã®æ¥ç¶šãƒ†ã‚¹ãƒˆ

3. **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³æº–å‚™**
   - Phase 1ã®ãƒ†ãƒ¼ãƒ–ãƒ«è¨­è¨ˆã‚’ç¢ºå®š
   - ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ

### ä»Šé€±ä¸­

4. **Phase 1ã®é–‹ç™ºé–‹å§‹**
   - Diagnosesãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆ
   - è¨ºæ–­çµæœAPIå®Ÿè£…
   - ç®¡ç†ç”»é¢UIå®Ÿè£…é–‹å§‹

---

**æœ€çµ‚æ›´æ–°æ—¥**: 2025-01  
**ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 1.0  
**ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: âœ… é–‹ç™ºè¨ˆç”»ç­–å®šå®Œäº†ã€é–‹ç™ºé–‹å§‹æº–å‚™å®Œäº†

