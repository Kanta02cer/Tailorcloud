# 顧客管理画面 実装完了・動作確認手順

**作成日**: 2025-01  
**ステータス**: ✅ 実装完了、動作確認準備完了

---

## ✅ 実装完了項目

### 1. 顧客管理画面（100%完了）

- ✅ **顧客一覧画面** (`customer_list_screen.dart`)
  - 顧客リスト表示（カード形式）
  - 検索機能（名前、メール、電話番号）
  - 新規顧客登録ボタン（FAB）
  - プルリフレッシュ対応

- ✅ **顧客詳細画面** (`customer_detail_screen.dart`)
  - 顧客情報表示（アバター、連絡先、登録日）
  - 注文履歴セクション（注文管理画面へのリンク準備済み）
  - 編集ボタン

- ✅ **新規顧客登録画面** (`customer_create_screen.dart`)
  - 顧客情報入力フォーム（名前、カナ、メール、電話、住所）
  - バリデーション（必須項目チェック、メール形式チェック）
  - 保存機能

- ✅ **顧客編集画面** (`customer_edit_screen.dart`)
  - 顧客情報編集フォーム
  - 更新機能

### 2. 追加実装

- ✅ **APIクライアントにPUTメソッド追加** (`api_client.dart`)
- ✅ **顧客更新プロバイダー実装** (`customer_provider.dart`)
- ✅ **EnterpriseColorsに色を追加** (`enterprise_theme.dart`)
  - `primaryBlue`: プライマリブルー
  - `errorRed`: エラー赤
  - `successGreen`: 成功緑
- ✅ **ナビゲーションに顧客管理を追加** (`app_navigation.dart`)
- ✅ **メイン画面に顧客管理画面を統合** (`main_screen.dart`)

### 3. 修正・改善

- ✅ 未使用のimportを削除
- ✅ テナントID取得の実装（開発用仮IDを使用）
- ✅ build_runnerでコード生成完了
- ✅ すべてのエラーを修正

---

## 🧪 動作確認手順

### 前提条件

1. **バックエンドAPIが起動していること**
   ```bash
   ./scripts/start_backend.sh
   ```
   - ヘルスチェック: `curl http://localhost:8080/health`
   - 正常な場合は `"OK"` が返る

2. **データベースが接続可能であること**
   - PostgreSQLが起動している
   - マイグレーションが実行済み

### 動作確認手順

#### 1. Flutterアプリの起動

```bash
cd tailor-cloud-app
flutter pub get
flutter run
```

または

```bash
./scripts/start_flutter.sh
```

#### 2. 顧客管理画面へのアクセス

1. アプリ起動後、サイドバーの「Customer」アイコンをタップ
2. 顧客一覧画面が表示されることを確認

#### 3. 顧客一覧の確認

- [ ] 顧客リストが表示される（データがない場合は空のメッセージ）
- [ ] 検索バーが表示される
- [ ] 新規顧客登録ボタン（右下のFAB）が表示される

#### 4. 新規顧客登録のテスト

1. 新規顧客登録ボタンをタップ
2. 顧客情報を入力：
   - 顧客名（必須）: 例「田中 太郎」
   - カナ名（任意）: 例「タナカ タロウ」
   - メールアドレス（任意）: 例「tanaka@example.com」
   - 電話番号（任意）: 例「090-1234-5678」
   - 住所（任意）: 例「東京都渋谷区...」
3. 「保存」ボタンをタップ
4. 成功メッセージが表示され、顧客一覧に戻ることを確認
5. 登録した顧客が一覧に表示されることを確認

#### 5. 顧客詳細の確認

1. 顧客一覧で顧客カードをタップ
2. 顧客詳細画面が表示されることを確認
3. 顧客情報（名前、メール、電話、住所、登録日）が正しく表示されることを確認
4. 編集ボタン（右上）が表示されることを確認

#### 6. 顧客編集のテスト

1. 顧客詳細画面で編集ボタンをタップ
2. 顧客情報を編集
3. 「更新」ボタンをタップ
4. 成功メッセージが表示され、顧客詳細画面に戻ることを確認
5. 編集した情報が反映されていることを確認

#### 7. 検索機能のテスト

1. 顧客一覧画面の検索バーに文字を入力
2. 検索結果がリアルタイムでフィルターされることを確認
3. 検索クリアボタン（×）で検索をクリアできることを確認

#### 8. プルリフレッシュのテスト

1. 顧客一覧画面で下にスワイプ
2. リストが更新されることを確認

---

## 🔧 トラブルシューティング

### エラー: 「テナントIDが取得できません」

**原因**: 認証情報が取得できていない

**対処法**:
- 現在は開発用の仮テナントID (`tenant-123`) を使用しています
- 実際の認証実装時は、JWTトークンのカスタムクレームから取得する必要があります

### エラー: API接続エラー

**原因**: バックエンドAPIが起動していない、または接続できない

**対処法**:
1. バックエンドAPIが起動しているか確認
   ```bash
   curl http://localhost:8080/health
   ```
2. 環境変数 `API_BASE_URL` が正しく設定されているか確認
3. ファイアウォールやネットワーク設定を確認

### エラー: データベース接続エラー

**原因**: PostgreSQLが起動していない、または接続情報が間違っている

**対処法**:
1. PostgreSQLが起動しているか確認
2. 環境変数（`POSTGRES_HOST`, `POSTGRES_USER`, `POSTGRES_PASSWORD`, `POSTGRES_DB`）を確認
3. マイグレーションが実行済みか確認

### エラー: ビルドエラー

**原因**: 依存関係が不足している、またはコード生成が必要

**対処法**:
```bash
cd tailor-cloud-app
flutter pub get
flutter pub run build_runner build --delete-conflicting-outputs
```

---

## 📊 動作確認チェックリスト

### 基本機能

- [ ] 顧客一覧画面が表示される
- [ ] 新規顧客登録ができる
- [ ] 顧客詳細が表示される
- [ ] 顧客情報を編集できる
- [ ] 検索機能が動作する
- [ ] プルリフレッシュが動作する

### UI/UX

- [ ] エラーメッセージが適切に表示される
- [ ] 成功メッセージが適切に表示される
- [ ] ローディングインジケーターが表示される
- [ ] 画面遷移がスムーズである

### API連携

- [ ] 顧客一覧取得APIが正常に動作する
- [ ] 顧客作成APIが正常に動作する
- [ ] 顧客取得APIが正常に動作する
- [ ] 顧客更新APIが正常に動作する

---

## 🚀 次のステップ

動作確認が完了したら、次のタスクに進みます：

### 優先度: 🔴 高

1. **注文管理画面の実装**
   - 注文一覧画面
   - 注文詳細画面
   - 注文確認画面
   - 発注書PDF表示画面

2. **クイック発注画面の改善**
   - 3ステップフローの確認・改善

3. **統合テスト・動作確認**
   - 全画面の動作確認
   - API連携確認

---

## 📝 注意事項

### 開発環境での注意

- 現在は開発用の仮テナントID (`tenant-123`) を使用しています
- 実際の認証実装時は、JWTトークンのカスタムクレームからテナントIDを取得する必要があります
- 注文管理画面は未実装のため、顧客詳細画面の「すべて見る」ボタンは一時的に無効化されています

### 本番環境への移行時

- 認証機能の完全実装
- テナントIDの適切な取得
- エラーハンドリングの強化
- セキュリティチェックの追加

---

**最終更新日**: 2025-01  
**ステータス**: ✅ 実装完了、動作確認準備完了

