# TailorCloud CRMï¼ˆé¡§å®¢ç®¡ç†ï¼‰æ©Ÿèƒ½ å®Ÿè£…å®Œäº†ãƒ¬ãƒãƒ¼ãƒˆ

**ä½œæˆæ—¥**: 2025-01  
**æ©Ÿèƒ½**: ç°¡æ˜“çš„CRMï¼ˆé¡§å®¢ç®¡ç†ï¼‰  
**ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: âœ… å®Œäº†

---

## âœ… å®Ÿè£…å®Œäº†å†…å®¹

### 1. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒ âœ…

**ãƒ•ã‚¡ã‚¤ãƒ«**: `tailor-cloud-backend/migrations/005_create_customers_table.sql`

**ãƒ†ãƒ¼ãƒ–ãƒ«è¨­è¨ˆ**:
- `customers` ãƒ†ãƒ¼ãƒ–ãƒ«
- ãƒãƒ«ãƒãƒ†ãƒŠãƒ³ãƒˆå¯¾å¿œï¼ˆ`tenant_id`ã§åˆ†é›¢ï¼‰
- ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ä½œæˆï¼ˆãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å‘ä¸Šï¼‰
- æ¤œç´¢æœ€é©åŒ–ï¼ˆåå‰ã€ãƒ¡ãƒ¼ãƒ«ã€é›»è©±ç•ªå·ï¼‰

**ã‚«ãƒ©ãƒ **:
- `id` (UUID)
- `tenant_id` (ãƒ†ãƒŠãƒ³ãƒˆID)
- `name` (é¡§å®¢å)
- `email` (ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹)
- `phone` (é›»è©±ç•ªå·)
- `address` (ä½æ‰€) - å°†æ¥æ‹¡å¼µç”¨
- `notes` (å‚™è€ƒ) - å°†æ¥æ‹¡å¼µç”¨
- `created_at`, `updated_at` (ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—)

**ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: âœ… å®Œäº†

---

### 2. é¡§å®¢ãƒªãƒã‚¸ãƒˆãƒªå®Ÿè£… âœ…

**ãƒ•ã‚¡ã‚¤ãƒ«**: `tailor-cloud-backend/internal/repository/customer_repository.go`

**å®Ÿè£…ãƒ¡ã‚½ãƒƒãƒ‰**:
- âœ… `Create` - é¡§å®¢ä½œæˆ
- âœ… `GetByID` - é¡§å®¢IDã§å–å¾—ï¼ˆãƒ†ãƒŠãƒ³ãƒˆãƒã‚§ãƒƒã‚¯ä»˜ãï¼‰
- âœ… `GetByTenantID` - ãƒ†ãƒŠãƒ³ãƒˆã®é¡§å®¢ä¸€è¦§å–å¾—
- âœ… `Search` - é¡§å®¢æ¤œç´¢ï¼ˆåå‰ã€ãƒ¡ãƒ¼ãƒ«ã€é›»è©±ç•ªå·ï¼‰
- âœ… `Update` - é¡§å®¢æ›´æ–°
- âœ… `Delete` - é¡§å®¢å‰Šé™¤

**ç‰¹å¾´**:
- ãƒãƒ«ãƒãƒ†ãƒŠãƒ³ãƒˆåˆ†é›¢ï¼ˆtenant_idå¿…é ˆï¼‰
- NULLè¨±å®¹ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰å¯¾å¿œï¼ˆemail, phoneï¼‰
- ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°å®Œå‚™

**ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: âœ… å®Œäº†

---

### 3. é¡§å®¢ã‚µãƒ¼ãƒ“ã‚¹å®Ÿè£… âœ…

**ãƒ•ã‚¡ã‚¤ãƒ«**: `tailor-cloud-backend/internal/service/customer_service.go`

**å®Ÿè£…ãƒ¡ã‚½ãƒƒãƒ‰**:
- âœ… `CreateCustomer` - é¡§å®¢ä½œæˆ
- âœ… `GetCustomer` - é¡§å®¢å–å¾—
- âœ… `ListCustomers` - é¡§å®¢ä¸€è¦§å–å¾—ï¼ˆæ¤œç´¢å¯¾å¿œï¼‰
- âœ… `UpdateCustomer` - é¡§å®¢æ›´æ–°
- âœ… `DeleteCustomer` - é¡§å®¢å‰Šé™¤
- âœ… `GetCustomerOrders` - **é¡§å®¢ã®æ³¨æ–‡å±¥æ­´å–å¾—**

**ç‰¹å¾´**:
- ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯å±¤ã¨ã—ã¦ã®è²¬å‹™åˆ†é›¢
- ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè£…
- æ³¨æ–‡å±¥æ­´ã¨ã®ç´ä»˜ã‘æ©Ÿèƒ½

**ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: âœ… å®Œäº†

---

### 4. é¡§å®¢APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆå®Ÿè£… âœ…

**ãƒ•ã‚¡ã‚¤ãƒ«**: `tailor-cloud-backend/internal/handler/customer_handler.go`

**å®Ÿè£…ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**:

#### 4.1 é¡§å®¢CRUD

- âœ… `POST /api/customers` - é¡§å®¢ç™»éŒ²
- âœ… `GET /api/customers/{id}` - é¡§å®¢è©³ç´°å–å¾—
- âœ… `GET /api/customers` - é¡§å®¢ä¸€è¦§å–å¾—ï¼ˆæ¤œç´¢å¯¾å¿œï¼‰
- âœ… `PUT /api/customers/{id}` - é¡§å®¢æ›´æ–°
- âœ… `DELETE /api/customers/{id}` - é¡§å®¢å‰Šé™¤

#### 4.2 é¡§å®¢é–¢é€£æ©Ÿèƒ½

- âœ… `GET /api/customers/{id}/orders` - **é¡§å®¢ã®æ³¨æ–‡å±¥æ­´å–å¾—**

**èªè¨¼ãƒ»èªå¯**:
- âœ… Firebaseèªè¨¼çµ±åˆ
- âœ… RBACå®Ÿè£…
  - ä½œæˆãƒ»æ›´æ–°: Owner or Staff
  - å‰Šé™¤: Owner only
  - å–å¾—ãƒ»ä¸€è¦§: å…¨å“¡ï¼ˆèªè¨¼æ¸ˆã¿ï¼‰

**ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: âœ… å®Œäº†

---

## ğŸ“¡ APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆè©³ç´°

### POST /api/customers

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆ**:
```json
{
  "name": "å±±ç”°å¤ªéƒ",
  "email": "yamada@example.com",
  "phone": "090-1234-5678"
}
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹**: `201 Created`
```json
{
  "id": "uuid",
  "tenant_id": "tenant-123",
  "name": "å±±ç”°å¤ªéƒ",
  "email": "yamada@example.com",
  "phone": "090-1234-5678",
  "created_at": "2025-01-01T00:00:00Z",
  "updated_at": "2025-01-01T00:00:00Z"
}
```

---

### GET /api/customers/{id}

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹**: `200 OK`
```json
{
  "id": "uuid",
  "tenant_id": "tenant-123",
  "name": "å±±ç”°å¤ªéƒ",
  "email": "yamada@example.com",
  "phone": "090-1234-5678",
  "created_at": "2025-01-01T00:00:00Z",
  "updated_at": "2025-01-01T00:00:00Z"
}
```

---

### GET /api/customers?search=å±±ç”°

**ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿**:
- `search` (optional): æ¤œç´¢ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ï¼ˆåå‰ã€ãƒ¡ãƒ¼ãƒ«ã€é›»è©±ç•ªå·ã§æ¤œç´¢ï¼‰

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹**: `200 OK`
```json
{
  "customers": [
    {
      "id": "uuid",
      "tenant_id": "tenant-123",
      "name": "å±±ç”°å¤ªéƒ",
      "email": "yamada@example.com",
      "phone": "090-1234-5678",
      "created_at": "2025-01-01T00:00:00Z",
      "updated_at": "2025-01-01T00:00:00Z"
    }
  ],
  "total": 1
}
```

---

### PUT /api/customers/{id}

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆ**:
```json
{
  "name": "å±±ç”°å¤ªéƒï¼ˆæ›´æ–°ï¼‰",
  "email": "yamada-updated@example.com",
  "phone": "090-1234-5679"
}
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹**: `200 OK`
```json
{
  "id": "uuid",
  "tenant_id": "tenant-123",
  "name": "å±±ç”°å¤ªéƒï¼ˆæ›´æ–°ï¼‰",
  "email": "yamada-updated@example.com",
  "phone": "090-1234-5679",
  "created_at": "2025-01-01T00:00:00Z",
  "updated_at": "2025-01-01T01:00:00Z"
}
```

---

### DELETE /api/customers/{id}

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹**: `204 No Content`

---

### GET /api/customers/{id}/orders

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹**: `200 OK`
```json
{
  "orders": [
    {
      "id": "order-uuid",
      "tenant_id": "tenant-123",
      "customer_id": "customer-uuid",
      "fabric_id": "fabric-uuid",
      "status": "confirmed",
      "total_amount": 100000,
      "delivery_date": "2025-12-31T00:00:00Z",
      "created_at": "2025-01-01T00:00:00Z"
    }
  ],
  "total": 1
}
```

---

## ğŸ”„ çµ±åˆå®Ÿè£…

### main.goã¸ã®çµ±åˆ âœ…

**ãƒ•ã‚¡ã‚¤ãƒ«**: `tailor-cloud-backend/cmd/api/main.go`

**å®Ÿè£…å†…å®¹**:
- âœ… CustomerRepositoryã®åˆæœŸåŒ–
- âœ… CustomerServiceã®åˆæœŸåŒ–ï¼ˆOrderRepositoryã‚’æ³¨å…¥ï¼‰
- âœ… CustomerHandlerã®åˆæœŸåŒ–
- âœ… ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°è¿½åŠ ï¼ˆ6ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆï¼‰

**ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: âœ… å®Œäº†

---

## ğŸ“Š å®Ÿè£…çµ±è¨ˆ

### æ–°è¦ä½œæˆãƒ•ã‚¡ã‚¤ãƒ«

- `tailor-cloud-backend/migrations/005_create_customers_table.sql` (ç´„30è¡Œ)
- `tailor-cloud-backend/internal/repository/customer_repository.go` (ç´„240è¡Œ)
- `tailor-cloud-backend/internal/service/customer_service.go` (ç´„180è¡Œ)
- `tailor-cloud-backend/internal/handler/customer_handler.go` (ç´„350è¡Œ)

### æ›´æ–°ãƒ•ã‚¡ã‚¤ãƒ«

- `tailor-cloud-backend/cmd/api/main.go` (ç´„20è¡Œè¿½åŠ )

### åˆè¨ˆ

- **è¿½åŠ ã‚³ãƒ¼ãƒ‰è¡Œæ•°**: ç´„820è¡Œ
- **æ–°è¦ãƒ•ã‚¡ã‚¤ãƒ«æ•°**: 4ãƒ•ã‚¡ã‚¤ãƒ«
- **æ›´æ–°ãƒ•ã‚¡ã‚¤ãƒ«æ•°**: 1ãƒ•ã‚¡ã‚¤ãƒ«
- **APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆæ•°**: 6ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ

---

## ğŸ¯ å®Ÿè£…ã•ã‚ŒãŸæ©Ÿèƒ½

### 1. åŸºæœ¬çš„ãªCRMæ©Ÿèƒ½ âœ…

- âœ… é¡§å®¢ã®ç™»éŒ²ãƒ»ç·¨é›†ãƒ»å‰Šé™¤
- âœ… é¡§å®¢ä¸€è¦§è¡¨ç¤º
- âœ… é¡§å®¢æ¤œç´¢ï¼ˆåå‰ã€ãƒ¡ãƒ¼ãƒ«ã€é›»è©±ç•ªå·ï¼‰
- âœ… é¡§å®¢è©³ç´°è¡¨ç¤º

### 2. æ³¨æ–‡å±¥æ­´ã¨ã®ç´ä»˜ã‘ âœ…

- âœ… é¡§å®¢ã”ã¨ã®æ³¨æ–‡å±¥æ­´å–å¾—
- âœ… æ™‚ç³»åˆ—ã§ã®è¡¨ç¤º
- âœ… ãƒ†ãƒŠãƒ³ãƒˆåˆ†é›¢ï¼ˆãƒãƒ«ãƒãƒ†ãƒŠãƒ³ãƒˆå¯¾å¿œï¼‰

### 3. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ»èªè¨¼ âœ…

- âœ… Firebaseèªè¨¼çµ±åˆ
- âœ… RBACï¼ˆãƒ­ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ï¼‰
- âœ… ãƒãƒ«ãƒãƒ†ãƒŠãƒ³ãƒˆåˆ†é›¢

---

## ğŸš€ ãƒ†ã‚¹ãƒˆæ–¹æ³•

### 1. é¡§å®¢ã‚’ä½œæˆ

```bash
curl -X POST http://localhost:8080/api/customers \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer {JWT_TOKEN}" \
  -d '{
    "name": "å±±ç”°å¤ªéƒ",
    "email": "yamada@example.com",
    "phone": "090-1234-5678"
  }'
```

### 2. é¡§å®¢ä¸€è¦§ã‚’å–å¾—

```bash
curl -X GET "http://localhost:8080/api/customers?search=å±±ç”°" \
  -H "Authorization: Bearer {JWT_TOKEN}"
```

### 3. é¡§å®¢è©³ç´°ã‚’å–å¾—

```bash
curl -X GET http://localhost:8080/api/customers/{customer_id} \
  -H "Authorization: Bearer {JWT_TOKEN}"
```

### 4. é¡§å®¢ã®æ³¨æ–‡å±¥æ­´ã‚’å–å¾—

```bash
curl -X GET http://localhost:8080/api/customers/{customer_id}/orders \
  -H "Authorization: Bearer {JWT_TOKEN}"
```

---

## âš ï¸ æ³¨æ„äº‹é …

### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³

1. **ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ**:
   ```bash
   psql -U postgres -d tailorcloud -f migrations/005_create_customers_table.sql
   ```

2. **ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆç¢ºèª**:
   ```sql
   \d customers
   ```

### é–‹ç™ºç’°å¢ƒã§ã®å‹•ä½œ

1. **èªè¨¼**:
   - Firebaseèªè¨¼ãƒˆãƒ¼ã‚¯ãƒ³ãŒå¿…è¦
   - ã¾ãŸã¯ã€é–‹ç™ºç’°å¢ƒã§ã¯`OptionalAuth`ã‚’ä½¿ç”¨

2. **ãƒ†ãƒŠãƒ³ãƒˆID**:
   - èªè¨¼ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‹ã‚‰è‡ªå‹•å–å¾—
   - ã¾ãŸã¯ã€ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿`tenant_id`ã§æŒ‡å®šï¼ˆé–‹ç™ºç’°å¢ƒç”¨ï¼‰

---

## ğŸ”„ æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

### å®Ÿè£…æ¸ˆã¿ï¼ˆMVPè¦ä»¶ï¼‰

- âœ… é¡§å®¢ã®ç™»éŒ²ãƒ»ç·¨é›†ãƒ»å‰Šé™¤
- âœ… é¡§å®¢ä¸€è¦§è¡¨ç¤ºï¼ˆæ¤œç´¢å¯¾å¿œï¼‰
- âœ… é¡§å®¢ã”ã¨ã®æ³¨æ–‡å±¥æ­´è¡¨ç¤º
- âœ… åŸºæœ¬çš„ãªæ¡å¯¸ãƒ‡ãƒ¼ã‚¿ã®ä¿å­˜ï¼ˆOrderDetails.MeasurementDataã¨ã—ã¦æ—¢å­˜ï¼‰

### å°†æ¥ã®æ‹¡å¼µï¼ˆPhase 2ä»¥é™ï¼‰

- âŒ é¡§å®¢ã®è©³ç´°æƒ…å ±ï¼ˆä½æ‰€ã€ç”Ÿå¹´æœˆæ—¥ã€ã‚µã‚¤ã‚ºæƒ…å ±ãªã©ï¼‰
- âŒ é¡§å®¢ã®çµ±è¨ˆæƒ…å ±ï¼ˆç´¯è¨ˆè³¼å…¥é¡ã€æ³¨æ–‡ä»¶æ•°ãªã©ï¼‰
- âŒ é¡§å®¢ã‚°ãƒ«ãƒ¼ãƒ—æ©Ÿèƒ½
- âŒ é¡§å®¢ã¸ã®ãƒ¡ãƒ¼ãƒ«é€ä¿¡æ©Ÿèƒ½
- âŒ é¡§å®¢ã®æ¡å¯¸å±¥æ­´è©³ç´°è¡¨ç¤º

---

## âœ… ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

### CRMæ©Ÿèƒ½å®Ÿè£…å®Œäº†é …ç›®

- [x] ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒä½œæˆ
- [x] é¡§å®¢ãƒªãƒã‚¸ãƒˆãƒªå®Ÿè£…
- [x] é¡§å®¢ã‚µãƒ¼ãƒ“ã‚¹å®Ÿè£…
- [x] é¡§å®¢APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆå®Ÿè£…
- [x] æ³¨æ–‡å±¥æ­´ã¨ã®ç´ä»˜ã‘
- [x] èªè¨¼ãƒ»èªå¯çµ±åˆ
- [x] main.goã¸ã®çµ±åˆ
- [x] ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°è¿½åŠ 
- [x] ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æˆåŠŸ
- [x] ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

---

**æœ€çµ‚æ›´æ–°æ—¥**: 2025-01  
**ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: âœ… CRMæ©Ÿèƒ½å®Ÿè£…å®Œäº†

**æ¬¡ã®æ©Ÿèƒ½**: ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å®Ÿè£…ï¼ˆFlutterï¼‰ã¾ãŸã¯ ä»–ã®MVPæ©Ÿèƒ½

